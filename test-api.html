<!DOCTYPE html>
<html>
<head>
  <title>测试群聊API</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
  </style>
</head>
<body>
  <h1>测试群聊API数据</h1>
  <button onclick="testAPI()">点击测试API</button>
  <div id="output"></div>

  <script>
    async function testAPI() {
      const output = document.getElementById('output');
      output.innerHTML = '<p>正在获取数据...</p>';

      try {
        const response = await fetch('http://localhost:3000/api/conversations');
        const data = await response.json();

        console.log('API返回的完整数据:', data);

        // 查找群聊
        const groupConversations = data.filter(c => c.type === 'group');

        let html = '<h2>群聊数据分析</h2>';

        groupConversations.forEach(conv => {
          html += `<h3>群聊: ${conv.name}</h3>`;
          html += `<p>群聊ID: ${conv.id}</p>`;
          html += `<p>成员数量: ${conv.members.length}</p>`;
          html += '<h4>成员详情:</h4>';
          html += '<pre>' + JSON.stringify(conv.members.map(m => ({
            id: m.id,
            name: m.full_name,
            role: m.role,
            hasRoleField: 'role' in m
          })), null, 2) + '</pre>';
        });

        if (groupConversations.length === 0) {
          html += '<p style="color: red;">未找到群聊</p>';
        }

        output.innerHTML = html;

      } catch (error) {
        output.innerHTML = `<p style="color: red;">错误: ${error.message}</p>`;
        console.error('API错误:', error);
      }
    }
  </script>
</body>
</html>
