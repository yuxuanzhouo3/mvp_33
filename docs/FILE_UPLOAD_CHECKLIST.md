# æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ£€æŸ¥æ¸…å•

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ–‡ä»¶ä¸Šä¼  API
- âœ… **è·¯ç”±**: `POST /api/messages/upload`
- âœ… **åŠŸèƒ½**: ä¸Šä¼ æ–‡ä»¶åˆ° Supabase Storage
- âœ… **éªŒè¯**: 
  - ç”¨æˆ·è®¤è¯æ£€æŸ¥
  - å¯¹è¯æˆå‘˜éªŒè¯
  - æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰
- âœ… **å­˜å‚¨ä½ç½®**: `messages/{conversationId}/{filename}`

### 2. æ¶ˆæ¯å‘é€é›†æˆ
- âœ… **æ–‡ä»¶ä¸Šä¼ æµç¨‹**:
  1. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
  2. ç«‹å³æ˜¾ç¤ºé¢„è§ˆï¼ˆä½¿ç”¨ blob URLï¼‰
  3. å‘é€æ—¶å…ˆä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
  4. è·å–æ–‡ä»¶ URL
  5. å°† URL å­˜å‚¨åœ¨æ¶ˆæ¯ metadata ä¸­
  6. å‘é€æ¶ˆæ¯åˆ° API

### 3. Storage é…ç½®
- âœ… **SQL è„šæœ¬**: `scripts/025_setup_messages_storage.sql`
- âœ… **Bucket**: `messages`
- âœ… **æƒé™**: 
  - å¯¹è¯æˆå‘˜å¯ä»¥ä¸Šä¼ 
  - å¯¹è¯æˆå‘˜å¯ä»¥æŸ¥çœ‹
  - å¯¹è¯æˆå‘˜å¯ä»¥åˆ é™¤

### 4. UI æ˜¾ç¤º
- âœ… **å›¾ç‰‡é¢„è§ˆ**: æ¶ˆæ¯åˆ—è¡¨ä¸­æ˜¾ç¤ºå›¾ç‰‡
- âœ… **æ–‡ä»¶æ˜¾ç¤º**: æ˜¾ç¤ºæ–‡ä»¶åã€å¤§å°ã€å›¾æ ‡
- âœ… **è§†é¢‘æ”¯æŒ**: æ”¯æŒè§†é¢‘æ–‡ä»¶

## ğŸ”§ éœ€è¦æ£€æŸ¥çš„æ­¥éª¤

### æ­¥éª¤ 1: è¿è¡Œ Storage è®¾ç½®è„šæœ¬

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©é¡¹ç›®ï¼š`communication_tool`
3. è¿›å…¥ **SQL Editor**
4. è¿è¡Œè„šæœ¬ï¼š`scripts/025_setup_messages_storage.sql`
5. ç‚¹å‡» **Run** æ‰§è¡Œ

### æ­¥éª¤ 2: éªŒè¯ Storage Bucket

1. åœ¨ Supabase Dashboard ä¸­ï¼Œè¿›å…¥ **Storage**
2. æ£€æŸ¥æ˜¯å¦æœ‰ `messages` bucket
3. æ£€æŸ¥ bucket æ˜¯å¦ä¸º public
4. æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶æ˜¯å¦ä¸º 10MB

### æ­¥éª¤ 3: æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`
2. æ‰“å¼€èŠå¤©é¡µé¢
3. é€‰æ‹©ä¸€ä¸ªå¯¹è¯
4. ç‚¹å‡»å›¾ç‰‡æŒ‰é’®æˆ–æ–‡ä»¶æŒ‰é’®
5. é€‰æ‹©ä¸€å¼ å›¾ç‰‡
6. å‘é€æ¶ˆæ¯
7. æ£€æŸ¥ï¼š
   - å›¾ç‰‡æ˜¯å¦ç«‹å³æ˜¾ç¤º
   - å›¾ç‰‡æ˜¯å¦ä¸Šä¼ åˆ°æœåŠ¡å™¨
   - åˆ·æ–°é¡µé¢åå›¾ç‰‡æ˜¯å¦è¿˜åœ¨

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: "Storage bucket not found"
**åŸå› **: æ²¡æœ‰è¿è¡Œ SQL è„šæœ¬åˆ›å»º bucket

**è§£å†³**:
1. è¿è¡Œ `scripts/025_setup_messages_storage.sql`
2. æ£€æŸ¥ Storage ä¸­æ˜¯å¦æœ‰ `messages` bucket

### é—®é¢˜ 2: "Failed to upload file"
**åŸå› **: å¯èƒ½æ˜¯æƒé™é—®é¢˜æˆ–æ–‡ä»¶å¤ªå¤§

**è§£å†³**:
1. æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 10MB
2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯å¯¹è¯æˆå‘˜
3. æ£€æŸ¥ Storage æƒé™ç­–ç•¥

### é—®é¢˜ 3: å›¾ç‰‡ä¸Šä¼ åæ¶ˆå¤±
**åŸå› **: blob URL è¢«è¿‡æ—©æ¸…ç†

**è§£å†³**: å·²ä¿®å¤ï¼Œç°åœ¨ä¼šå»¶è¿Ÿæ¸…ç† blob URL

### é—®é¢˜ 4: åˆ é™¤æ¶ˆæ¯åå·¦ä¾§åˆ—è¡¨ä¸æ›´æ–°
**åŸå› **: åˆ é™¤æ¶ˆæ¯åæ²¡æœ‰åˆ·æ–°å¯¹è¯åˆ—è¡¨

**è§£å†³**: å·²ä¿®å¤ï¼Œåˆ é™¤æ¶ˆæ¯åä¼šè‡ªåŠ¨é‡æ–°åŠ è½½å¯¹è¯ä¿¡æ¯

## ğŸ“ æµ‹è¯•æ¸…å•

- [ ] å¯ä»¥ä¸Šä¼ å›¾ç‰‡
- [ ] å¯ä»¥ä¸Šä¼ è§†é¢‘
- [ ] å¯ä»¥ä¸Šä¼ å…¶ä»–æ–‡ä»¶
- [ ] å›¾ç‰‡ç«‹å³æ˜¾ç¤ºé¢„è§ˆ
- [ ] ä¸Šä¼ åå›¾ç‰‡ä¸æ¶ˆå¤±
- [ ] åˆ·æ–°é¡µé¢åå›¾ç‰‡è¿˜åœ¨
- [ ] åˆ é™¤æ¶ˆæ¯åå·¦ä¾§åˆ—è¡¨æ›´æ–°
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶ç”Ÿæ•ˆï¼ˆ10MBï¼‰
- [ ] éå¯¹è¯æˆå‘˜æ— æ³•ä¸Šä¼ æ–‡ä»¶

## ğŸ” è°ƒè¯•æ–¹æ³•

### æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹ Network æ ‡ç­¾
3. æ£€æŸ¥ `/api/messages/upload` è¯·æ±‚
4. æŸ¥çœ‹å“åº”çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯

### æ£€æŸ¥ Supabase Storage
1. åœ¨ Supabase Dashboard ä¸­ï¼Œè¿›å…¥ **Storage** > **messages**
2. æŸ¥çœ‹æ˜¯å¦æœ‰ä¸Šä¼ çš„æ–‡ä»¶
3. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼š`{conversationId}/{filename}`

### æ£€æŸ¥æ•°æ®åº“
1. åœ¨ Supabase Dashboard ä¸­ï¼Œè¿›å…¥ **Table Editor** > **messages**
2. æŸ¥çœ‹æ¶ˆæ¯çš„ `metadata` å­—æ®µ
3. æ£€æŸ¥ `file_url` æ˜¯å¦å­˜åœ¨

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `app/api/messages/upload/route.ts` - æ–‡ä»¶ä¸Šä¼  API
- `app/chat/page.tsx` - æ¶ˆæ¯å‘é€é€»è¾‘
- `components/chat/message-input.tsx` - æ–‡ä»¶é€‰æ‹© UI
- `components/chat/message-list.tsx` - æ¶ˆæ¯æ˜¾ç¤º
- `scripts/025_setup_messages_storage.sql` - Storage è®¾ç½®è„šæœ¬












